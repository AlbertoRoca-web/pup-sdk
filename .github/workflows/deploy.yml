name: Deploy to HuggingFace

on:
  push:
    branches: [ main ]

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo (full clone)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install huggingface_hub
        run: pip install huggingface_hub

      - name: Clone HuggingFace Space
        env:
          HF_TOKEN: ${{ secrets.HUGGINGPUP }}
        run: |
          echo "üîó Cloning HuggingFace Space..."
          rm -rf hf-space
          git clone "https://AlbertoRoca96-web:${HF_TOKEN}@huggingface.co/spaces/AlbertoRoca96-web/pup-sdk" hf-space
          cd hf-space
          echo "üìÅ Space repo contents:"
          ls -la

      - name: Sync project files into Space repo
        run: |
          echo "üíæ Syncing files into hf-space..."
          # adjust these paths to match what you actually want in the Space
          cp -v app.py hf-space/
          cp -v requirements.txt hf-space/
          cp -v Dockerfile hf-space/ || true

          # copy the SDK package itself
          if [ -d "pup_sdk" ]; then
            rsync -av --delete pup_sdk/ hf-space/pup_sdk/
          fi

          # if you have templates/static/etc outside pup_sdk, copy them too
          if [ -d "pup_sdk/web" ]; then
            echo "‚úÖ pup_sdk/web present"
          fi

          echo "üìã Updated hf-space contents:"
          ls -la hf-space/

      - name: Commit and push to HuggingFace Space
        env:
          HF_TOKEN: ${{ secrets.HUGGINGPUP }}
        run: |
          cd hf-space

          git config user.name  "Alberto Code Puppy"
          git config user.email "alberto@code-puppy.ai"

          git add -A

          if git diff --cached --quiet; then
            echo "‚ÑπÔ∏è No changes to commit"
          else
            echo "üíæ Committing and pushing..."
            git commit -m "Sync from GitHub main"
            git push
          fi

          echo "‚úÖ Space deployment complete!"
