name: Deploy Alberto to HuggingFace Spaces

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check out repository
      uses: actions/checkout@v4
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install Hugging Face Hub
      run: |
        pip install huggingface_hub
        
    - name: Deploy to HuggingFace Spaces
      env:
        HF_TOKEN: ${{ secrets.HUGGINGPUP }}
      run: |
        echo "üêï Deploying Alberto to HuggingFace Spaces..."
        
        # Debug token presence
        if [ -z "$HF_TOKEN" ]; then
          echo "‚ùå HUGGINGPUP secret not found"
          echo "Available secrets:"
          printenv | grep -i hug
          exit 1
        fi
        
        echo "‚úÖ Found HUGGINGPUP token (length: ${#HF_TOKEN})"
        echo "Token starts with: ${HF_TOKEN:0:10}..."
        
        # Try the official hf upload method
        python -c "
import os
from huggingface_hub import HfApi
api = HfApi(token=os.environ.get('HF_TOKEN'))
try:
    # Upload files
    api.upload_folder(
        folder_path='.',
        repo_id='AlbertoRoca96-web/pup-sdk',
        repo_type='space',
        commit_message='üêï Auto-deploy Alberto mobile interface'
    )
    print('üéâ SUCCESS! Alberto deployed to HuggingFace Spaces!')
    print('üåê Space URL: https://huggingface.co/spaces/AlbertoRoca96-web/pup-sdk')
except Exception as e:
    print(f'‚ùå Upload failed: {e}')
    exit(1)
"
        
        if [ $? -eq 0 ]; then
          echo "‚úÖ Deployment completed successfully!"
        else
          echo "‚ùå Deployment failed!"
          exit 1
        fi