name: Deploy Alberto to HuggingFace Spaces

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Deploy to HuggingFace Spaces
      env:
        HF_TOKEN: ${{ secrets.HUGGINGPUP }}
      run: |
        echo "Deploying Alberto to HuggingFace Spaces..."
        
        if [ -z "$HF_TOKEN" ]; then
          echo "HUGGINGPUP secret not found"
          exit 1
        fi
        
        echo "Found HUGGINGPUP token"
        
        # Clone the space
        git clone https://$HF_TOKEN@huggingface.co/spaces/AlbertoRoca96-web/pup-sdk
        
        # Remove existing git to avoid conflicts
        rm -rf pup-sdk/.git
        
        # Copy deployment files
        cp app.py Dockerfile requirements.txt README.md pup-sdk/
        
        # Setup git user
        cd pup-sdk
        git config user.name "github-actions"
        git config user.email "actions@github.com"
        git init
        git remote add origin https://$HF_TOKEN@huggingface.co/spaces/AlbertoRoca96-web/pup-sdk
        
        # Add and commit files
        git add .
        git commit -m "Deploy Alberto mobile interface"
        
        # Push to deploy
        git push origin main --force
        
        echo "SUCCESS! Alberto deployed!"