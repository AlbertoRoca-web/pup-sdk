name: Deploy Alberto to HuggingFace Spaces

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: Setup git
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        
    - name: Checkout HF Space
      env:
        HF_TOKEN: ${{ secrets.HUGGINGPUP }}
      run: |
        git clone https://$HF_TOKEN@huggingface.co/spaces/AlbertoRoca96-web/pup-sdk
        
    - name: Sync files
      run: |
        # Delete existing git repo to avoid conflicts
        rm -rf AlbertoRoca96-web-pup-sdk/.git
        
        # Copy deployment files
        cp app.py Dockerfile requirements.txt README.md AlbertoRoca96-web-pup-sdk/
        
        # Copy any additional needed files
        if [ -d "pup_sdk" ]; then
            cp -r pup_sdk AlbertoRoca96-web-pup-sdk/ || true
        fi
        
    - name: Commit and push
      env:
        HF_TOKEN: ${{ secrets.HUGGINGPUP }}
      run: |
        cd AlbertoRoca96-web-pup-sdk
        
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git config credential.helper '!echo password=$HF_TOKEN'
        
        git add .
        git diff --staged --quiet || git commit -m "üêï Alberto auto-deploy
Deploy Alberto mobile interface with FastAPI and Docker
- Mobile-friendly chat interface
- Touch-optimized design
- Real-time responses with typing indicators
- Sassy Alberto personality
- Docker configuration for HuggingFace Spaces
- Auto-deployed from GitHub Actions"
        
        git push https://$HF_TOKEN@huggingface.co/spaces/AlbertoRoca96-web/pup-sdk main --force
        
        echo "üéâ SUCCESS! Alberto deployed to HuggingFace Spaces!"
        echo "üåê Space URL: https://huggingface.co/spaces/AlbertoRoca96-web/pup-sdk"
        echo "üì± Build starting now - Alberto will be live on mobile in 2-5 minutes!"
        echo "üê∂ WOOF! Alberto is coming to HuggingFace! üöÄ"