name: Deploy Alberto to HuggingFace Spaces

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check out repository
      uses: actions/checkout@v4
      
    - name: Setup Git
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
    - name: Clone HuggingFace Space
      env:
        HF_TOKEN: ${{ secrets.HUGGINGPUP }}
      run: |
        if [ -z "$HF_TOKEN" ]; then
          echo "‚ùå HUGGINGPUP secret not found"
          exit 1
        fi
        
        echo "‚úÖ Found HUGGINGPUP token (length: ${#HF_TOKEN})"
        
        # Clone the Space
        git clone https://huggingface.co/spaces/AlbertoRoca96-web/pup-sdk.git hf-space
        
        # Configure the remote with token
        cd hf-space
        git remote set-url origin https://${HF_TOKEN}@huggingface.co/spaces/AlbertoRoca96-web/pup-sdk.git
        
    - name: Copy files to HuggingFace Space
      run: |
        # Copy all source files to the HuggingFace Space repo
        cp app.py Dockerfile requirements.txt README.md hf-space/
        
    - name: Commit and push to HuggingFace
      run: |
        cd hf-space
        git add .
        git commit -m "üêï Auto-deploy Alberto mobile interface [skip ci]"
        git push origin main
        
        if [ $? -eq 0 ]; then
          echo "üéâ SUCCESS! Alberto deployed to HuggingFace Spaces!"
          echo "üåê Space URL: https://huggingface.co/spaces/AlbertoRoca96-web/pup-sdk"
          echo "‚è±Ô∏è Build starting now... wait 2-5 minutes"
          echo "üì± Alberto will be live on mobile soon!"
        else
          echo "‚ùå Deployment failed during git push!"
          exit 1
        fi